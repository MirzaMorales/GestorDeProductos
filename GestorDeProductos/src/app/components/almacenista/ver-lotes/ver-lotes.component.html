<div class="container mt-4">
    <div class="row">
        <div class="col-md-4 pe-4 border-end">
            <app-registrar-lote></app-registrar-lote>
        </div>

        <div class="col-md-8">
            <div *ngIf="loteSeleccionado; else maestroView">
                <h4>Detalles del Lote</h4>
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title">Producto: {{ loteSeleccionado.producto }}</h5>
                        <p class="card-text">Cajas: {{ loteSeleccionado.cantidadComprada }}</p>
                        <p class="card-text"><small class="text-muted">Fecha de caducidad: {{ loteSeleccionado.fechaCaducidad | date:'yyyy-MM-dd' }}</small></p>
                        <p class="card-text"><small class="text-muted">Código: {{ loteSeleccionado.codigoLote }}</small></p>
                        <p class="card-text"><small class="text-muted">Código de Barras: {{ loteSeleccionado.codigoBarras }}</small></p>
                        <p class="card-text"><small class="text-muted">Fecha de registro: {{ loteSeleccionado.fechaRegistro | date:'yyyy-MM-dd' }}</small></p>
                        
                        <button class="btn btn-danger w-100 mt-2" (click)="eliminarLote()">Eliminar Lote</button>
                        <button class="btn btn-secondary w-100 mt-2" (click)="regresar()">Regresar</button>
                    </div>
                </div>
            </div>

            <ng-template #maestroView>
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4>Lotes</h4>
                
                    <!-- ComboBox para elegir tipo de búsqueda -->
                    <select class="form-select w-auto me-2" [(ngModel)]="tipoBusqueda" (change)="filtrarLotes()">
                        <option value="todos" selected>Todos</option>
                        <option value="codigo">Código de Lote</option>
                        <option value="nombre">Nombre del Producto</option>
                    </select>
                
                    <!-- Input de búsqueda habilitado solo si se selecciona un filtro específico -->
                    <div class="input-group w-50">
                        <input type="text" class="form-control" [(ngModel)]="filtroTexto" 
                               [disabled]="!tipoBusqueda || tipoBusqueda === 'todos'" placeholder="Ingrese valor">
                        <button class="btn btn-outline-primary" type="button" (click)="filtrarLotes()" 
                                [disabled]="!tipoBusqueda || tipoBusqueda === 'todos' || !filtroTexto.trim()">🔍</button>
                    </div>
                </div>
                

                <div class="d-flex justify-content-end mb-3">
                    <label class="me-2">Ordenar por:</label>
                    <select class="form-select w-auto" [(ngModel)]="ordenamiento" (change)="ordenarLotes()">
                        <option value="asc">Fecha de caducidad (Ascendente)</option>
                        <option value="desc">Fecha de caducidad (Descendente)</option>
                    </select>
                </div>

                <div class="scrollable-container">
                    <div class="row">
                        <div class="col-md-4" *ngFor="let lote of lotes">
                            <div class="card shadow-sm" (click)="seleccionarLote(lote)" style="cursor: pointer;">
                                <div class="card-body">
                                    <h5 class="card-title">Producto: {{ lote.producto }}</h5>
                                    <p class="card-text"><small class="text-muted">Código de lote: {{ lote.codigoLote }}</small></p>
                                    <h6 class="card-title">Código de Barras: {{ lote.codigoBarras }}</h6>
                                    <p class="card-text">Cajas: {{ lote.cantidadComprada }}</p>
                                    <p class="card-text"><small class="text-muted">Fecha de caducidad: {{ lote.fechaCaducidad | date:'yyyy-MM-dd' }}</small></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </ng-template>
        </div>
    </div>
</div>
