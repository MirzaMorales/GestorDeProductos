<div class="container mt-4">
    <div class="row">
        <div class="col-md-4 pe-4 border-end">
            <app-registrar-lote></app-registrar-lote>
        </div>

        <!-- Sección de lotes (Vista Maestro-Detalle) -->
        <div class="col-md-8">
            <!-- Si hay un lote seleccionado, mostrar detalle -->
            <div *ngIf="loteSeleccionado; else maestroView">
                <h4>Detalles del Lote</h4>
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title">Producto: {{ loteSeleccionado.producto }}</h5>
                        <p class="card-text">Cajas: {{ loteSeleccionado.cantidadComprada }}</p>
                        <p class="card-text"><small class="text-muted">Fecha de caducidad: {{ loteSeleccionado.fechaCaducidad | date:'yyyy-MM-dd' }}</small></p>
                        <p class="card-text"><small class="text-muted">Código: {{ loteSeleccionado.codigoLote }}</small></p>
                        <p class="card-text"><small class="text-muted">Fecha de registro: {{ loteSeleccionado.fechaRegistro | date:'yyyy-MM-dd' }}</small></p>
                        
                        <!-- Botón para eliminar el lote -->
                        <button class="btn btn-danger w-100 mt-2" (click)="eliminarLote()">Eliminar Lote</button>
                        <button class="btn btn-secondary w-100 mt-2" (click)="regresar()">Regresar</button>
                    </div>
                </div>
            </div>

            <!-- Vista Maestro (Lista de lotes) -->
            <ng-template #maestroView>
                <!-- Filtros de búsqueda y ordenación -->
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4>Lotes</h4>
                    <div class="input-group w-50">
                        <input type="text" class="form-control" [(ngModel)]="filtroCodigo" placeholder="Buscar por código">
                        <button class="btn btn-outline-primary" type="button" (click)="filtrarPorCodigoLote()">🔍</button>
                    </div>
                    <div class="input-group w-50 ms-2">
                        <input type="text" class="form-control" [(ngModel)]="filtroNombre" placeholder="Buscar por nombre">
                        <button class="btn btn-outline-secondary" type="button" (click)="filtrarPorNombre()">🔍</button>
                    </div>
                </div>

                <!-- Selector de ordenación -->
                <div class="d-flex justify-content-end mb-3">
                    <label class="me-2">Ordenar por:</label>
                    <select class="form-select w-auto" [(ngModel)]="ordenamiento" (change)="ordenarLotes()">
                        <option value="asc">Fecha de caducidad (Ascendente)</option>
                        <option value="desc">Fecha de caducidad (Descendente)</option>
                    </select>
                </div>

                <!-- Contenedor de lotes con scroll -->
                <div class="scrollable-container">
                    <div class="row">
                        <div class="col-md-4" *ngFor="let lote of lotes">
                            <div class="card shadow-sm" (click)="seleccionarLote(lote)" style="cursor: pointer;">
                                <div class="card-body">
                                    <h5 class="card-title">Producto: {{ lote.producto }}</h5>
                                    <p class="card-text">Cajas: {{ lote.cantidadComprada }}</p>
                                    <p class="card-text"><small class="text-muted">Fecha de caducidad: {{ lote.fechaCaducidad | date:'yyyy-MM-dd' }}</small></p>
                                    <p class="card-text"><small class="text-muted">Código: {{ lote.codigoLote }}</small></p>
                                    <p class="card-text"><small class="text-muted">Fecha de registro: {{ lote.fechaRegistro | date:'yyyy-MM-dd' }}</small></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </ng-template>
        </div> 
    </div> 
</div>
