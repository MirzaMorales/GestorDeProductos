<!-- Filtros -->
<div class="d-flex flex-column flex-md-row justify-content-between align-items-center mb-4 p-3">
    <h4 class="mb-3 mb-md-0">Productos</h4>
    <div class="d-flex flex-column flex-sm-row align-items-center gap-3">
      <!-- Select Ordenar -->
      <div class="input-group">
        <select
          [(ngModel)]="filtro"
          id="filtro"
          name="filtro"
          (change)="filtrarPorCategoria(filtro)"
          class="form-select d-inline w-auto"
        >
          <option value="" disabled selected>Ordenar por categoría</option>
          <option value="">Todos</option>
          <option *ngFor="let categoria of categorias" [value]="categoria.nombreCategoria">
            {{ categoria.nombreCategoria }}
          </option>
        </select>
      </div>
  
      <!-- Input de búsqueda - Nombre del producto -->
      <div class="input-group">
        <input
          class="form-control"
          type="search"
          placeholder="Nombre del producto"
          aria-label="Search"
          [(ngModel)]="nombreProducto"
          (input)="filtrarPorNombre(nombreProducto)"
        />
        <!-- Ícono de búsqueda -->
        <div class="btn-icon" (click)="filtrarPorNombre(nombreProducto)">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
            <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0" />
          </svg>
        </div>
      </div>
  
      <!-- Input de búsqueda - Código de barras -->
      <div class="input-group">
        <input
          class="form-control"
          type="search"
          placeholder="Código del producto"
          aria-label="Search"
          [(ngModel)]="codigoBarras"
          (input)="filtrarPorCodigoBarras(codigoBarras)"
        />
        <div class="btn-icon" (click)="filtrarPorCodigoBarras(codigoBarras)">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
            <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0" />
          </svg>
        </div>
      </div>
    </div>
    
    <!-- Botón de Agregar Producto -->
    <div class="add-product-btn">
      <button class="btn btn-primary" type="button" (click)="openAddDialog()">Agregar Producto</button>
    </div>
  </div>
  


<!-- Cards de productos -->
<div class="product-cards">
    <div *ngFor="let producto of productos" class="product-card">
        <img [src]="producto.imagenUrl" alt="{{ producto.nombreProducto }}">
        <h3>{{ producto.nombreProducto }}</h3>
        <h3>{{ producto.codigoBarras }}</h3>
        <p>Categoría: {{ producto.categoria }}</p>
        <p>Stock: {{ producto.stockAlmacen }}</p>

        <!-- Contenedor de botones -->
        <div class="button-container">
            <button (click)="openEditDialog(producto)">Editar</button>
            <button (click)="deleteProducto(producto.id)">Eliminar</button>
            <button (click)="openExistenciasDialog(producto)">Existencias</button>
        </div>
    </div>
</div>

<!-- Cuadro de diálogo para Editar Producto -->
<div *ngIf="isEditDialogOpen" class="edit-dialog">
    <div class="dialog-content">
        <h2>Editar Producto</h2>
        <form (ngSubmit)="updateProducto()">
            <label for="nombreProducto">Nombre</label>
            <input type="text" id="nombreProducto" [(ngModel)]="currentProducto.nombreProducto" name="nombreProducto">

            <label for="codigoBarras">Código de barras</label>
            <input type="text" id="codigoBarras" [(ngModel)]="currentProducto.codigoBarras" name="codigoBarras">

            <label for="tamano">Tamaño</label>
            <select id="tamano" [(ngModel)]="currentProducto.tamano" name="tamano">
                <option *ngFor="let tamano of tamanios" [value]="tamano">{{ tamano }}</option>
            </select>

            <label for="categoria">Categoría</label>
            <select id="categoria" [(ngModel)]="currentProducto.categoria" name="categoria">
                <option *ngFor="let categoria of categorias" [value]="categoria">{{ categoria }}</option>
            </select>

            <label for="proveedorSelect">Seleccionar Proveedor</label>
            <select id="proveedorSelect" [(ngModel)]="proveedorInputEdit" name="proveedorSelect">
                <option *ngFor="let proveedor of proveedores" [value]="proveedor">{{ proveedor }}</option>
            </select>
            <button type="button" (click)="agregarProveedorEdit()">Agregar Proveedor</button>
            
            <!-- Lista de proveedores seleccionados para el producto -->
            <ul>
                <li *ngFor="let proveedor of currentProducto.proveedor; let i = index">
                    {{ proveedor }} 
                    <button type="button" (click)="eliminarProveedorEdit(i)">Eliminar</button>
                </li>
            </ul>
            
            


            <label for="imagenUrl">Imagen URL</label>
            <input type="text" id="imagenUrl" [(ngModel)]="currentProducto.imagenUrl" name="imagenUrl">

            <label for="precioPieza">Precio por pieza</label>
            <input type="number" id="precioPieza" [(ngModel)]="currentProducto.precioPieza" name="precioPieza">

            <label for="precioCaja">Precio por caja</label>
            <input type="number" id="precioCaja" [(ngModel)]="currentProducto.precioCaja" name="precioCaja">

            <label for="cantidadPiezasPorCaja">Cantidad por caja</label>
            <input type="number" id="cantidadPiezasPorCaja" [(ngModel)]="currentProducto.cantidadPiezasPorCaja"
                name="cantidadPiezasPorCaja">

            <div class="dialog-buttons">
                <button type="submit" class="save-button">Guardar cambios</button>
                <button type="button" class="cancel-button" (click)="closeEditDialog()">Cancelar</button>
            </div>
        </form>
    </div>
</div>

<!-- Cuadro de diálogo para Actualizar Existencias -->
<div *ngIf="isExistenciasDialogOpen" class="existencias-dialog">
    <div class="dialog-content">
        <h2>Actualizar Existencias</h2>
        <form (ngSubmit)="actualizarStock()">
            <label for="codigoBarras">Código de Barras</label>
            <input type="text" id="codigoBarras" [(ngModel)]="productoExistencias.codigoBarras" name="codigoBarras"
                readonly>
            <input type="text" id="codigoBarras" [(ngModel)]="productoExistencias.codigoBarras" name="codigoBarras"
                readonly>

            <label for="nombreProducto">Nombre del Producto</label>
            <input type="text" id="nombreProducto" [(ngModel)]="productoExistencias.nombreProducto"
                name="nombreProducto" readonly>
            <input type="text" id="nombreProducto" [(ngModel)]="productoExistencias.nombreProducto"
                name="nombreProducto" readonly>

            <label for="stockNuevo">Nuevo Stock</label>
            <input type="number" id="stockNuevo" [(ngModel)]="productoExistencias.stockNuevo" name="stockNuevo">

            <div class="dialog-buttons">
                <button type="submit" class="save-button">Actualizar Stock</button>
                <button type="button" class="cancel-button" (click)="closeExistenciasDialog()">Cancelar</button>
            </div>
        </form>
    </div>
</div>

<!-- Formulario para agregar producto -->
<div *ngIf="isAddDialogOpen" class="add-dialog">
    <div class="dialog-content">
        <app-agregar-producto (close)="closeAddDialog()"></app-agregar-producto>
    </div>
</div>